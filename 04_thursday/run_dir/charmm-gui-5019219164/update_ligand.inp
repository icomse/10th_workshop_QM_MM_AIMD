* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v2.0
* SETUP PERIODIC BOUNDARY CONDITION
*

DIMENS CHSIZE 5000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read PSF and Coordinates
read psf  card name step3_pbcsetup.psf 
read coor card name step3_pbcsetup.crd 

energy

calc ncharge = int( ?cgtot )
set mnd 5
set sol ( .not. segid SOLV )

if ncharge .eq. 0 then
goto skipaddion
endif

if ncharge .lt. 0 then
set icl 0
calc ina @ncharge * -1 
stream addions.str
else
calc icl @ncharge * 1
set ina 0
stream addions.str
endif

label skipaddion

open write unit 10 card name step3_ligupdated.psf
write psf  unit 10 card

open write card unit 10 name step3_ligupdated.crd
write coor unit 10 card

open write card unit 10 name step3_ligupdated.pdb
write coor pdb  unit 10 official

stop